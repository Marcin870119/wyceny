<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Selection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }

        #searchInput {
            margin: 15px auto;
            padding: 10px;
            width: 90%;
            font-size: 16px;
            display: block;
            box-sizing: border-box;
        }

        #saveButtonTop, #saveButtonBottom {
            margin: 15px auto;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            display: block;
            width: 90%;
            box-sizing: border-box;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 14px;
        }

        th {
            background-color: #f2f2f2;
        }

        @media (max-width: 768px) {
            th, td {
                font-size: 12px;
                padding: 5px;
            }

            #searchInput, #saveButtonTop, #saveButtonBottom {
                font-size: 14px;
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            th, td {
                display: block;
                width: 100%;
                box-sizing: border-box;
            }

            tr {
                margin-bottom: 10px;
                display: block;
            }

            #searchInput, #saveButtonTop, #saveButtonBottom {
                font-size: 12px;
                padding: 6px;
            }

            table {
                border: none;
            }

            th {
                display: none;
            }

            td {
                border: none;
                display: flex;
                justify-content: space-between;
                padding: 5px 10px;
            }

            td::before {
                content: attr(data-label);
                flex-basis: 40%;
                font-weight: bold;
            }

            td:last-child {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">Product Selection</h1>
    <input type="text" id="searchInput" placeholder="Search by Index or Name..." onkeyup="filterTable()">
    <button id="saveButtonTop" type="button" onclick="saveSelection()">Save Selection</button>
    <form id="productForm">
        <table>
            <thead>
                <tr>
                    <th>Select</th>
                    <th>Index</th>
                    <th>Name</th>
                    <th>Producer</th>
                    <th>Quantity</th>
                    <th>Group</th>
                </tr>
            </thead>
            <tbody id="productTable">
                <!-- Rows will be added dynamically -->
            </tbody>
        </table>
        <button id="saveButtonBottom" type="button" onclick="saveSelection()">Save Selection</button>
    </form>

    <script>
        // Define the product list here
        let products = [
            { index: 1, name: "CHIPICAO ROGALIK 60G CHIPITA Z NADZIENIEM KAKAO", producer: "MONDELEZ POLSKA", quantity: 20, group: "SŁODYCZE" },
            { index: 7, name: "7 DAYS ROGALIK 60G KAKAO", producer: "MONDELEZ POLSKA", quantity: 30, group: "SŁODYCZE" },
            { index: 12, name: "7 DAYS ROGALIK 185G MINI KAKAO", producer: "MONDELEZ POLSKA", quantity: 8, group: "SŁODYCZE" },
            { index: 14, name: "AGI SMALEC 180G WYBOROWY Z CEBULKĄ I SKWARKAMI", producer: "AGII", quantity: 20, group: "TŁUSZCZE" },
            { index: 15, name: "PIATNICA SEREK WIEJSKI 200G", producer: "OSM PIĄTNICA", quantity: 12, group: "PRZETWORY MLECZARSKIE" },
            { index: 16, name: "PIATNICA SEREK WIEJSKI JABŁKO CYNAMON 150G", producer: "OSM PIĄTNICA", quantity: 9, group: "PRZETWORY MLECZARSKIE" }
        ];

        const tableBody = document.getElementById("productTable");

        // Populate table with products
        function loadProducts() {
            products.forEach(product => {
                const row = document.createElement("tr");

                row.innerHTML = `
                    <td><input type="checkbox" name="product" value="${product.index}"></td>
                    <td data-label="Index">${product.index}</td>
                    <td data-label="Name">${product.name}</td>
                    <td data-label="Producer">${product.producer}</td>
                    <td data-label="Quantity">${product.quantity}</td>
                    <td data-label="Group">${product.group}</td>
                `;

                tableBody.appendChild(row);
            });
        }

        function saveSelection() {
            const selectedProducts = [];
            const checkboxes = document.querySelectorAll("input[name='product']:checked");

            checkboxes.forEach(checkbox => {
                const index = checkbox.value;
                const product = products.find(p => p.index == index);
                if (product) selectedProducts.push(product);
            });

            // Convert selected products to XLS
            const worksheet = XLSX.utils.json_to_sheet(selectedProducts);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Selected Products");

            // Save file
            XLSX.writeFile(workbook, "selected_products.xlsx");
        }

        function filterTable() {
            const query = document.getElementById("searchInput").value.toLowerCase().trim();
            const searchTerms = query.split(" ").filter(term => term !== ""); // Split and filter empty terms
            const rows = document.getElementById("productTable").getElementsByTagName("tr");

            for (let i = 0; i < rows.length; i++) {
                const indexCell = rows[i].getElementsByTagName("td")[1];
                const nameCell = rows[i].getElementsByTagName("td")[2];

                if (indexCell && nameCell) {
                    const indexText = indexCell.textContent.toLowerCase() || "";
                    const nameText = nameCell.textContent.toLowerCase() || "";

                    // Check if every term matches either the index or name
                    const matches = searchTerms.every(term =>
                        indexText.includes(term) || nameText.includes(term)
                    );

                    rows[i].style.display = matches ? "" : "none";
                }
            }
        }

        // Load products on page load
        loadProducts();
    </script>
</body>
</html>
